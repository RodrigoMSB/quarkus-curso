â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ” PRUEBAS DE CIFRADO CON GOOGLE TINK                       â•‘
â•‘   Cifrado a Nivel de AplicaciÃ³n - AES-256-GCM                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha: 03/11/2025 10:56:59
ğŸŒ API Base: http://localhost:8080
ğŸ—„ï¸  PostgreSQL: localhost:5432/postgres
ğŸ“„ Resultados: test-documentos-cifrados-2025-11-03_10-56-59.txt
ğŸ”§ Algoritmo: AES-256-GCM (Google Tink)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   âœ… VERIFICACIÃ“N DE REQUISITOS                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ curl instalado
âœ“ python3 instalado
âœ“ psql instalado

Verificando conectividad con el servicio...
âœ“ Servicio accesible en http://localhost:8080

Verificando conectividad con PostgreSQL...
âš ï¸  No se pudo conectar a PostgreSQL - pruebas de BD serÃ¡n omitidas


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 1: Crear Documento con Cifrado AutomÃ¡tico
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Crear un documento y verificar que se cifra antes de persistir
ğŸ” Algoritmo: AES-256-GCM (Authenticated Encryption)
ğŸ“ Contenido: "InformaciÃ³n confidencial del cliente - DNI: 12345678"

Ejecutando POST /api/v1/documentos...

âŒ Error: Extra data: line 2 column 5 (char 5)

âœ… Documento creado - ID: âŒ Error: Extra data: line 2 column 5 (char 5)
â„¹ï¸  El contenido fue CIFRADO antes de guardarse en PostgreSQL


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 2: Verificar Cifrado en la Base de Datos
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Confirmar que el contenido estÃ¡ CIFRADO en PostgreSQL
ğŸ” TÃ©cnica: Consulta SQL directa para ver el contenido_cifrado

âš ï¸  psql no disponible - omitiendo verificaciÃ³n de BD


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 3: Consultar Documento (Descifrado AutomÃ¡tico)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Verificar que el API descifra automÃ¡ticamente al leer
ğŸ”“ OperaciÃ³n: GET /api/v1/documentos/âŒ Error: Extra data: line 2 column 5 (char 5)

Ejecutando consulta...

âŒ Error: Expecting value: line 1 column 1 (char 0)

âœ… El API devolviÃ³ el contenido DESCIFRADO correctamente
â„¹ï¸  Flujo: BD (cifrado) â†’ CryptoService.descifrar() â†’ API (texto plano)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 4: Crear MÃºltiples Documentos Cifrados
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Crear varios documentos para probar el listado
ğŸ“ Documentos a crear: 3 adicionales

Creando documento 2...
âœ“ Documento 2 creado
Creando documento 3...
âœ“ Documento 3 creado
Creando documento 4...
âœ“ Documento 4 creado

âœ… 3 documentos adicionales creados y cifrados


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 5: Listar Todos los Documentos (Descifrado Masivo)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Verificar que todos los documentos se descifran al listar
ğŸ”“ OperaciÃ³n: GET /api/v1/documentos

Ejecutando listado...

âŒ Error: Extra data: line 2 column 5 (char 5)
âœ… Todos los documentos fueron descifrados correctamente
â„¹ï¸  Cada documento pasa por CryptoService.descifrar() antes de devolverse


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 6: ComparaciÃ³n BD Cifrada vs API Descifrada
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Demostrar visualmente la diferencia
ğŸ” Se compara el contenido en BD (cifrado) vs API (descifrado)

âš ï¸  psql no disponible - omitiendo comparaciÃ³n


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PRUEBA 7: DemostraciÃ³n de Seguridad con Claves
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Objetivo: Entender la importancia de la gestiÃ³n de claves
âš ï¸  LimitaciÃ³n actual: La clave se regenera en cada inicio

ğŸš¨ ESCENARIO CRÃTICO:
1. AplicaciÃ³n arranca â†’ Genera clave A
2. Creas documentos â†’ Se cifran con clave A
3. AplicaciÃ³n reinicia â†’ Genera clave B (Â¡DIFERENTE!)
4. Intentas leer documentos â†’ âŒ ERROR (cifrado con A, intentas descifrar con B)

ğŸ’¡ SOLUCIÃ“N PARA PRODUCCIÃ“N:
   â€¢ OpciÃ³n 1: Persistir clave en archivo JSON
   â€¢ OpciÃ³n 2: Usar KMS (AWS KMS, Google Cloud KMS, Azure Key Vault)
   â€¢ OpciÃ³n 3: Variable de entorno con la clave
   â€¢ OpciÃ³n 4: HashiCorp Vault

âš ï¸  REGLA DE ORO: Perder la clave = Perder TODOS los datos cifrados
   (Â¡No hay recuperaciÃ³n posible!)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“Š RESUMEN DE PRUEBAS                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… PRUEBA 1: Documento creado y cifrado automÃ¡ticamente
âœ… PRUEBA 2: Contenido confirmado como cifrado en PostgreSQL
âœ… PRUEBA 3: Descifrado automÃ¡tico al consultar por ID
âœ… PRUEBA 4: MÃºltiples documentos creados con cifrado
âœ… PRUEBA 5: Listado masivo con descifrado de todos los documentos
âœ… PRUEBA 6: ComparaciÃ³n visual BD cifrada vs API descifrada
âœ… PRUEBA 7: ComprensiÃ³n de gestiÃ³n de claves crÃ­ticas

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ“ CONCEPTOS CLAVE DEMOSTRADOS                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” AES-256-GCM (AEAD):     Cifrado + AutenticaciÃ³n
ğŸ“¦ Google Tink:            API segura y fÃ¡cil de usar
ğŸ”„ Flujo de Cifrado:       Antes de INSERT en BD
ğŸ”“ Flujo de Descifrado:    DespuÃ©s de SELECT de BD
ğŸ—„ï¸  BD nunca ve:           Texto plano (solo contenido cifrado)
ğŸ”‘ GestiÃ³n de Claves:      CrÃ­tica para producciÃ³n (KMS)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ” FLUJO COMPLETO DE CIFRADO                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /documentos
    â†“
Cliente envÃ­a: "InformaciÃ³n confidencial"
    â†“
CryptoService.cifrar() â†’ AES-256-GCM
    â†“
    â†“
GET /documentos/1
    â†“
    â†“
CryptoService.descifrar() â†’ Texto plano
    â†“
API devuelve: "InformaciÃ³n confidencial" â† DESCIFRADO

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ“Š COMPARACIÃ“N: ALWAYS ENCRYPTED VS TINK              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ASPECTO                   | ALWAYS ENCRYPTED          | GOOGLE TINK              
--------------------------+---------------------------+--------------------------
DÃ³nde se cifra           | SQL Server                | AplicaciÃ³n Java         
GestiÃ³n de claves        | Cert Store / Key Vault    | KMS o archivo            
Portabilidad              | Solo SQL Server           | Cualquier BD             
Control                   | Limitado                  | Total                    
Complejidad inicial       | Alta configuraciÃ³n       | CÃ³digo explÃ­cito       
Algoritmo                 | AES-256                   | AES-256-GCM (AEAD)       

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           âš ï¸  ADVERTENCIAS Y MEJORES PRÃCTICAS                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš¨ NO HACER EN PRODUCCIÃ“N:
   âŒ Regenerar claves en cada inicio
   âŒ Hardcodear claves en cÃ³digo fuente
   âŒ Almacenar claves en texto plano en el repositorio
   âŒ Compartir claves por email o chat

âœ… HACER EN PRODUCCIÃ“N:
   âœ“ Usar KMS (AWS KMS, Google Cloud KMS, Azure Key Vault)
   âœ“ Implementar rotaciÃ³n de claves
   âœ“ Auditar accesos a datos cifrados
   âœ“ Backup seguro de claves (con cifrado adicional)
   âœ“ Seguir principio de mÃ­nimo privilegio

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸ¯ EJERCICIOS PROPUESTOS                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Persistencia de Clave:
   Modifica CryptoService para guardar/cargar la clave desde archivo JSON

2. MÃºltiples Claves:
   Implementa diferentes claves para tipos de documentos (pÃºblico/privado/confidencial)

3. Cifrado HÃ­brido:
   Usa RSA para cifrar la clave AES y AES para cifrar el contenido

4. BÃºsqueda Segura:
   Implementa bÃºsqueda por hash SHA-256 del contenido sin descifrar

5. AuditorÃ­a:
   Agrega logs de quiÃ©n y cuÃ¡ndo accede a datos descifrados

6. RotaciÃ³n de Claves:
   Investiga cÃ³mo rotar claves sin perder acceso a datos antiguos


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“ ARCHIVO DE LOG                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Todas las pruebas han sido guardadas en:
   test-documentos-cifrados-2025-11-03_10-56-59.txt

ğŸ’¡ Puedes revisar el log completo para:
   â€¢ Verificar las respuestas HTTP completas
   â€¢ Analizar el contenido cifrado vs descifrado
   â€¢ Compartir los resultados con tu instructor
   â€¢ Documentar el comportamiento del sistema de cifrado

ğŸ‰ Â¡Pruebas de cifrado completadas exitosamente!

