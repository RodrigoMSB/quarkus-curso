#!/bin/bash

#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üè¶ PRUEBAS INTERACTIVAS - API EVALUACI√ìN CREDITICIA (DNI PERUANO)
#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

API_URL="http://localhost:8080"
OUTPUT_FILE="resultados-evaluacion-crediticia-$(date '+%Y-%m-%d_%H-%M-%S').txt"

# Colores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
MAGENTA='\033[0;35m'
RESET='\033[0m'

# Contadores
TOTAL_TESTS=0
PASSED_TESTS=0
FAILED_TESTS=0

# Limpiar archivo de salida
> "$OUTPUT_FILE"

# Funci√≥n de logging mejorada
log() {
    local message="$*"
    printf "%b\n" "$message"
    printf "%b\n" "$message" | sed 's/\x1b\[[0-9;]*m//g' >> "$OUTPUT_FILE"
}

# Funci√≥n para mostrar JSON
show_json() {
    local json="$1"
    
    if ! command -v jq &> /dev/null; then
        printf "%s\n" "$json" | tee -a "$OUTPUT_FILE"
        return
    fi
    
    if [ -n "$json" ]; then
        echo "$json" | jq '.' 2>/dev/null | tee -a "$OUTPUT_FILE" || echo "$json" | tee -a "$OUTPUT_FILE"
    fi
}

# Funci√≥n para pausa interactiva
pause() {
    echo ""
    printf "${CYAN}‚ñ∂Ô∏è  Presiona ENTER para continuar...${RESET}"
    read -r
    echo ""
}

# Banner
clear
log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üè¶ PRUEBAS INTERACTIVAS - API EVALUACI√ìN CREDITICIA (QUARKUS)${RESET}     ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""
log "${CYAN}üìÖ Fecha:${RESET} $(date '+%d/%m/%Y %H:%M:%S')"
log "${CYAN}üåê API Base:${RESET} $API_URL"
log "${CYAN}üìÑ Resultados:${RESET} $OUTPUT_FILE"
log "${CYAN}üáµüá™ Validaci√≥n:${RESET} DNI Peruano (8 d√≠gitos num√©ricos)"
log "${CYAN}üíæ Base de Datos:${RESET} PostgreSQL (Dev Services autom√°tico)"
log "${CYAN}üéØ Umbral Aprobaci√≥n:${RESET} Score >= 650 puntos"
log ""

# Verificar servidor
log "${YELLOW}üîç Verificando conectividad con el servidor...${RESET}"
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" "$API_URL/api/v1/creditos" 2>/dev/null)
if [ "$HTTP_CODE" == "200" ]; then
    log "${GREEN}‚úÖ Servidor respondiendo correctamente${RESET}"
else
    log "${RED}‚ùå ERROR: No se puede conectar al servidor (HTTP: $HTTP_CODE)${RESET}"
    log ""
    log "${YELLOW}Soluciones:${RESET}"
    log "  ${WHITE}1.${RESET} Aseg√∫rate de que Docker Desktop est√° corriendo"
    log "  ${WHITE}2.${RESET} Navega a la carpeta del proyecto: ${CYAN}cd evaluacion-crediticia${RESET}"
    log "  ${WHITE}3.${RESET} Inicia Quarkus: ${CYAN}./mvnw quarkus:dev${RESET}"
    log "  ${WHITE}4.${RESET} Espera el mensaje: ${GREEN}Listening on: http://localhost:8080${RESET}"
    log ""
    exit 1
fi
log ""
pause

# Funci√≥n para ejecutar test con archivo temporal
run_test() {
    local test_num="$1"
    local test_name="$2"
    local method="$3"
    local endpoint="$4"
    local data="$5"
    local expected_status="$6"
    local description="$7"
    
    TOTAL_TESTS=$((TOTAL_TESTS + 1))
    
    clear
    log ""
    log "${CYAN}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${RESET}"
    log "${WHITE}üìã Test #$test_num: $test_name${RESET}"
    log "${CYAN}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${RESET}"
    log ""
    log "${YELLOW}Method:${RESET}   $method"
    log "${YELLOW}Endpoint:${RESET} $endpoint"
    
    if [ -n "$data" ]; then
        log ""
        log "${YELLOW}Request Body:${RESET}"
        show_json "$data"
    fi
    
    log ""
    log "${MAGENTA}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${RESET}"
    log ""
    
    # Ejecutar request usando archivo temporal para POST
    if [ -z "$data" ]; then
        response=$(curl -s -w "\n%{http_code}" -X "$method" "$endpoint" \
            -H "Content-Type: application/json" 2>/dev/null)
    else
        # SOLUCI√ìN WINDOWS: Escribir JSON en archivo temporal con printf para evitar problemas de encoding
        local temp_file=$(mktemp)
        printf '%s' "$data" > "$temp_file"
        
        response=$(curl -s -w "\n%{http_code}" -X "$method" "$endpoint" \
            -H "Content-Type: application/json" \
            --data-binary "@$temp_file" 2>/dev/null)
        
        rm -f "$temp_file"
    fi
    
    # Separar body y status
    body=$(echo "$response" | sed '$d')
    status=$(echo "$response" | tail -n 1)
    
    # Mostrar response
    log "${YELLOW}Response (HTTP $status):${RESET}"
    show_json "$body"
    log ""
    
    # Validar status
    if [ "$status" == "$expected_status" ]; then
        log "${GREEN}‚úì PASS${RESET} - HTTP $status (Esperado: $expected_status)"
        PASSED_TESTS=$((PASSED_TESTS + 1))
    else
        log "${RED}‚úó FAIL${RESET} - HTTP $status (Esperado: $expected_status)"
        FAILED_TESTS=$((FAILED_TESTS + 1))
    fi
    
    # Descripci√≥n del resultado esperado
    if [ -n "$description" ]; then
        log ""
        log "${CYAN}üí° Resultado esperado:${RESET}"
        log "   $description"
    fi
    
    # Capturar ID si existe
    if command -v jq &> /dev/null; then
        local captured_id=$(echo "$body" | jq -r '.solicitudId' 2>/dev/null)
        if [ -n "$captured_id" ] && [ "$captured_id" != "null" ]; then
            log ""
            log "${YELLOW}‚Üí Solicitud ID capturado: $captured_id${RESET}"
        fi
    fi
    
    pause
}

#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# M√ìDULO 1: EVALUACIONES EXITOSAS (APROBADAS)
#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

clear
log ""
log "${GREEN}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log "${WHITE}  ‚úÖ M√ìDULO 1: EVALUACIONES EXITOSAS (SOLICITUDES APROBADAS)${RESET}"
log "${GREEN}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log ""
log "${CYAN}Este m√≥dulo prueba solicitudes con perfiles crediticios s√≥lidos:${RESET}"
log "  ‚Ä¢ Ingresos estables y suficientes"
log "  ‚Ä¢ DTI (Debt-to-Income) por debajo del 50%"
log "  ‚Ä¢ Estabilidad laboral (>= 3 meses)"
log "  ‚Ä¢ Score esperado: >= 650 puntos"
log ""
pause

# Test 1: Perfil EXCELENTE
run_test 1 \
    "Solicitud con perfil EXCELENTE (Score >= 800)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"12345678","nombreCompleto":"Juan P√©rez Garc√≠a","email":"juan.perez@banco.pe","edad":35,"ingresosMensuales":2500000,"deudasActuales":300000,"montoSolicitado":5000000,"mesesEnEmpleoActual":48}' \
    "201" \
    "‚úÖ APROBADA - Score >= 800 - Excelente capacidad de pago, DTI bajo (12%), alta estabilidad laboral"

# Test 2: Perfil BUENO
run_test 2 \
    "Solicitud con perfil BUENO (Score 650-799)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"23456789","nombreCompleto":"Mar√≠a Silva Torres","email":"maria.silva@banco.pe","edad":28,"ingresosMensuales":1800000,"deudasActuales":400000,"montoSolicitado":3000000,"mesesEnEmpleoActual":24}' \
    "201" \
    "‚úÖ APROBADA - Score entre 650-799 - Buen perfil, DTI aceptable (22%), estabilidad laboral adecuada"

#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# M√ìDULO 2: EVALUACIONES RECHAZADAS
#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

clear
log ""
log "${RED}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log "${WHITE}  ‚ùå M√ìDULO 2: EVALUACIONES RECHAZADAS (ALTO RIESGO)${RESET}"
log "${RED}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log ""
log "${CYAN}Este m√≥dulo prueba solicitudes que no cumplen requisitos m√≠nimos:${RESET}"
log "  ‚Ä¢ DTI > 50% (sobre-endeudamiento)"
log "  ‚Ä¢ Inestabilidad laboral (< 3 meses)"
log "  ‚Ä¢ Score esperado: < 650 puntos o rechazo autom√°tico"
log ""
pause

# Test 3: DTI Alto
run_test 3 \
    "Rechazo por DTI alto (>50%)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"34567890","nombreCompleto":"Carlos Rojas Vega","email":"carlos.rojas@banco.pe","edad":42,"ingresosMensuales":1500000,"deudasActuales":900000,"montoSolicitado":4000000,"mesesEnEmpleoActual":12}' \
    "201" \
    "‚ùå RECHAZADA - DTI = 60% (l√≠mite: 50%) - Sobre-endeudamiento detectado, alto riesgo de impago"

# Test 4: Inestabilidad Laboral
run_test 4 \
    "Rechazo por inestabilidad laboral (<3 meses)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"45678901","nombreCompleto":"Ana L√≥pez Mu√±oz","email":"ana.lopez@banco.pe","edad":23,"ingresosMensuales":1200000,"deudasActuales":150000,"montoSolicitado":2000000,"mesesEnEmpleoActual":2}' \
    "201" \
    "‚ùå RECHAZADA - Empleo actual: 2 meses (m√≠nimo: 3) - Riesgo de p√©rdida de ingresos"

#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# M√ìDULO 3: VALIDACIONES Y CASOS EDGE
#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

clear
log ""
log "${YELLOW}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log "${WHITE}  üîç M√ìDULO 3: VALIDACIONES Y CASOS EDGE${RESET}"
log "${YELLOW}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log ""
log "${CYAN}Este m√≥dulo prueba validadores custom y manejo de errores:${RESET}"
log "  ‚Ä¢ Validaci√≥n de DNI peruano (8 d√≠gitos)"
log "  ‚Ä¢ Bean Validation (campos obligatorios)"
log "  ‚Ä¢ Exception Mappers (respuestas amigables)"
log ""
pause

# Test 5: DNI Inv√°lido (muy corto)
run_test 5 \
    "Validaci√≥n de DNI inv√°lido (5 d√≠gitos)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"12345","nombreCompleto":"Pedro Inv√°lido","email":"pedro@banco.pe","edad":30,"ingresosMensuales":2000000,"deudasActuales":200000,"montoSolicitado":3000000,"mesesEnEmpleoActual":12}' \
    "400" \
    "‚ùå Error 400 Bad Request - DNI debe tener exactamente 8 d√≠gitos. Validador @DniValido funcionando"

# Test 6: DNI Inv√°lido (muy largo)
run_test 6 \
    "Validaci√≥n de DNI inv√°lido (10 d√≠gitos)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"1234567890","nombreCompleto":"Luis Inv√°lido","email":"luis@banco.pe","edad":40,"ingresosMensuales":3000000,"deudasActuales":500000,"montoSolicitado":6000000,"mesesEnEmpleoActual":24}' \
    "400" \
    "‚ùå Error 400 Bad Request - DNI no puede exceder 8 d√≠gitos"

# Test 7: Email Inv√°lido
run_test 7 \
    "Validaci√≥n de email inv√°lido" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"87654321","nombreCompleto":"Rosa Flores","email":"email-invalido","edad":32,"ingresosMensuales":2200000,"deudasActuales":400000,"montoSolicitado":4000000,"mesesEnEmpleoActual":18}' \
    "400" \
    "‚ùå Error 400 Bad Request - Email debe tener formato v√°lido. Validador @Email funcionando"

# Test 8: Edad menor de 18
run_test 8 \
    "Validaci√≥n de edad m√≠nima (<18)" \
    "POST" \
    "$API_URL/api/v1/creditos/evaluar" \
    '{"dni":"11223344","nombreCompleto":"Menor Edad","email":"menor@banco.pe","edad":17,"ingresosMensuales":1000000,"deudasActuales":0,"montoSolicitado":1000000,"mesesEnEmpleoActual":6}' \
    "400" \
    "‚ùå Error 400 Bad Request - Edad m√≠nima 18 a√±os. Validador @Min funcionando"

#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# M√ìDULO 4: OPERACIONES DE CONSULTA
#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

clear
log ""
log "${CYAN}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log "${WHITE}  üìä M√ìDULO 4: OPERACIONES DE CONSULTA (GET)${RESET}"
log "${CYAN}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì${RESET}"
log ""
log "${CYAN}Este m√≥dulo prueba operaciones de lectura:${RESET}"
log "  ‚Ä¢ Listar todas las solicitudes"
log "  ‚Ä¢ Obtener solicitud espec√≠fica por ID"
log "  ‚Ä¢ Manejo de solicitudes inexistentes (404)"
log ""
pause

# Test 9: Listar todas las solicitudes
run_test 9 \
    "Listar todas las solicitudes" \
    "GET" \
    "$API_URL/api/v1/creditos" \
    "" \
    "200" \
    "‚úÖ Array con todas las solicitudes (aprobadas, rechazadas y pendientes). Incluye datos pre-cargados + tests ejecutados"

# Test 10: Obtener solicitud espec√≠fica
run_test 10 \
    "Obtener solicitud espec√≠fica (ID=1)" \
    "GET" \
    "$API_URL/api/v1/creditos/1" \
    "" \
    "200" \
    "‚úÖ Detalle completo de la solicitud: DNI, nombre, score, estado, raz√≥n de evaluaci√≥n"

# Test 11: Solicitud inexistente
run_test 11 \
    "Obtener solicitud inexistente (ID=99999)" \
    "GET" \
    "$API_URL/api/v1/creditos/99999" \
    "" \
    "404" \
    "‚ùå Error 404 Not Found - Solicitud no existe en la base de datos"

#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# RESUMEN FINAL
#‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

clear
log ""
log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üìä RESUMEN FINAL DE EJECUCI√ìN${RESET}                                          ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""

if [ $FAILED_TESTS -eq 0 ]; then
    log "  ${GREEN}üéâ ‚úì TODOS LOS TESTS PASARON EXITOSAMENTE${RESET}"
else
    log "  ${YELLOW}‚ö†Ô∏è  ALGUNOS TESTS FALLARON${RESET}"
fi

log ""
log "  ${WHITE}Tests Ejecutados:${RESET}  $TOTAL_TESTS"
log "  ${GREEN}‚úì Tests Exitosos:${RESET}  $PASSED_TESTS"
log "  ${RED}‚úó Tests Fallidos:${RESET}  $FAILED_TESTS"
log ""
log "  ${CYAN}üìÑ Resultados guardados en: $OUTPUT_FILE${RESET}"
log ""

log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üìä RESUMEN DE OPERACIONES PROBADAS${RESET}                                    ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""
log "  ${GREEN}‚úÖ EVALUACIONES EXITOSAS:${RESET}"
log "     ‚Ä¢ Perfil excelente (score >= 800)"
log "     ‚Ä¢ Perfil bueno (score 650-799)"
log ""
log "  ${RED}‚ùå EVALUACIONES RECHAZADAS:${RESET}"
log "     ‚Ä¢ DTI alto (>50%) - Sobre-endeudamiento"
log "     ‚Ä¢ Inestabilidad laboral (<3 meses)"
log ""
log "  ${YELLOW}üîç VALIDACIONES:${RESET}"
log "     ‚Ä¢ DNI peruano (8 d√≠gitos) - @DniValido"
log "     ‚Ä¢ Email v√°lido - @Email"
log "     ‚Ä¢ Edad m√≠nima (18 a√±os) - @Min"
log "     ‚Ä¢ Campos obligatorios - @NotBlank"
log ""
log "  ${CYAN}üìä CONSULTAS:${RESET}"
log "     ‚Ä¢ Listar todas las solicitudes (GET)"
log "     ‚Ä¢ Obtener solicitud espec√≠fica (GET)"
log "     ‚Ä¢ Manejo de 404 Not Found"
log ""

log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üéØ ALGORITMO DE SCORING CREDITICIO${RESET}                                    ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""
log "  ${WHITE}Factores Evaluados:${RESET}"
log "     ‚Ä¢ ${CYAN}DTI (Debt-to-Income):${RESET} L√≠mite 50%"
log "     ‚Ä¢ ${CYAN}Estabilidad laboral:${RESET} M√≠nimo 3 meses"
log "     ‚Ä¢ ${CYAN}Capacidad de pago:${RESET} Cuota <= 30% ingreso"
log "     ‚Ä¢ ${CYAN}Edad:${RESET} Rango √≥ptimo 25-55 a√±os"
log "     ‚Ä¢ ${CYAN}Monto solicitado:${RESET} vs ingreso mensual"
log ""
log "  ${WHITE}Escala de Score:${RESET}"
log "     ‚Ä¢ ${GREEN}800-1000:${RESET} Excelente (aprobaci√≥n inmediata)"
log "     ‚Ä¢ ${GREEN}650-799:${RESET}  Bueno (aprobaci√≥n est√°ndar)"
log "     ‚Ä¢ ${YELLOW}500-649:${RESET}  Regular (requiere an√°lisis)"
log "     ‚Ä¢ ${RED}0-499:${RESET}    Malo (rechazo autom√°tico)"
log ""
log "  ${WHITE}Umbral de Aprobaci√≥n: ${GREEN}650 puntos${RESET}"
log ""

log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üí° NOTAS T√âCNICAS${RESET}                                                      ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""
log "  ${CYAN}üìå Endpoint Base:${RESET} $API_URL/api/v1/creditos"
log "  ${CYAN}üìå DNI Peruano:${RESET} Exactamente 8 d√≠gitos num√©ricos"
log "  ${CYAN}üìå Base de Datos:${RESET} PostgreSQL (Dev Services - Testcontainers)"
log "  ${CYAN}üìå Testing:${RESET} JUnit 5 + REST Assured + @QuarkusTest"
log "  ${CYAN}üìå Validadores:${RESET} Bean Validation + Custom Validators"
log "  ${CYAN}üìå Exception Mappers:${RESET} Respuestas HTTP amigables"
log ""

log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üîó RECURSOS √öTILES${RESET}                                                     ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""
log "  ${CYAN}‚Üí Dev UI:${RESET}       http://localhost:8080/q/dev"
log "  ${CYAN}‚Üí Swagger UI:${RESET}   http://localhost:8080/q/swagger-ui"
log "  ${CYAN}‚Üí OpenAPI Spec:${RESET} http://localhost:8080/q/openapi"
log "  ${CYAN}‚Üí Health Check:${RESET} http://localhost:8080/q/health"
log ""

log "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${RESET}"
log "${CYAN}‚ïë${RESET}  ${WHITE}üìö CONCEPTOS DEMOSTRADOS - CAP√çTULO 5${RESET}                                 ${CYAN}‚ïë${RESET}"
log "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${RESET}"
log ""
log "  ${GREEN}‚úì${RESET} Testing con ${CYAN}@QuarkusTest${RESET} (JUnit 5)"
log "  ${GREEN}‚úì${RESET} REST Assured para testing de APIs"
log "  ${GREEN}‚úì${RESET} Dev Services (PostgreSQL autom√°tico)"
log "  ${GREEN}‚úì${RESET} Bean Validation (${CYAN}@NotBlank, @Email, @Min, @Max${RESET})"
log "  ${GREEN}‚úì${RESET} Validadores Custom (${CYAN}@DniValido${RESET})"
log "  ${GREEN}‚úì${RESET} Exception Mappers (respuestas amigables)"
log "  ${GREEN}‚úì${RESET} Hibernate ORM with Panache"
log "  ${GREEN}‚úì${RESET} Inyecci√≥n de dependencias (CDI)"
log "  ${GREEN}‚úì${RESET} L√≥gica de negocio bancaria (DTI, Scoring)"
log "  ${GREEN}‚úì${RESET} Manejo de errores HTTP (400, 404)"
log ""

log "${CYAN}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${RESET}"
log ""
log "  ${WHITE}üí° TIP: Para ver el archivo formateado:${RESET}"
log "     ${CYAN}cat $OUTPUT_FILE${RESET}"
log ""
log "  ${WHITE}üìñ Documentaci√≥n completa en:${RESET}"
log "     ${CYAN}TEORIA.md${RESET} - Conceptos y explicaciones"
log "     ${CYAN}TESTS.md${RESET}  - Gu√≠a de testing"
log ""

if [ $FAILED_TESTS -eq 0 ]; then
    exit 0
else
    exit 1
fi