================================================================
              PRUEBAS - PERFIL PROD                            
              Produccion: Maxima seguridad con Vault           
================================================================

Sistema Operativo: mac
Python: python3
Fecha: 20/11/2025 09:35:06
API Base: http://localhost:8080
Vault: http://localhost:8200
Resultados: test-prod-2025-11-20_09-35-06.txt
Perfil: PROD (produccion)

IMPORTANTE: El servidor se arrancara automaticamente en perfil prod
Requisito: Vault debe estar corriendo con el secreto guardado

Caracteristicas del perfil PROD:
  - Comision: 2.5% (completa)
  - Limite transaccional: 50,000 (alto pero controlado)
  - Cache: Activado
  - Auditoria: Activada
  - Proveedor: PremiumProvider
  - API Key: Desde Vault (seguro)


================================================================
VERIFICACION DE VAULT
================================================================

Verificando que Vault este corriendo...
Vault esta corriendo

Verificando secreto en Vault...
Secreto disponible en Vault


================================================================
PREPARACION Y COMPILACION
================================================================

Matando procesos previos de Quarkus y Java...
Limpieza completada

Compilando aplicacion...
Compilacion exitosa

Arrancando aplicacion en modo PROD...

PID de la aplicacion: 69335

Esperando a que la aplicacion arranque (timeout: 60s)...
Aplicacion lista en perfil PROD


================================================================
PRUEBA 1: Configuracion del Perfil PROD + Vault
================================================================

Objetivo: Verificar que la aplicacion esta en perfil PROD con Vault
Endpoint: GET /api/tasas/config
Esperado: perfil_activo=prod, comision=2.5%, limite=50,000, api_key desde Vault

Ejecutando consulta de configuracion...

Response (HTTP 200):
{
  "auditoria_habilitada": true,
  "monedas_soportadas": [
    "USD",
    "EUR",
    "MXN"
  ],
  "refresh_minutos": 15,
  "ambiente": "producciÃ³n",
  "aplicacion": "TasaCorp API",
  "moneda_base": "PEN",
  "perfil_activo": "prod",
  "comision_porcentaje": 2.5,
  "api_key_source": "Vault",
  "proveedor": "PremiumProvider",
  "proveedor_url": "https://api.currencylayer.com/live",
  "limite_transaccional": 50000,
  "cache_habilitado": true
}

PASS - Configuracion PROD obtenida correctamente
Validaciones:
  [OK] Perfil: prod
  [OK] Comision: 2.5%
  [OK] Limite: 50,000
  [OK] API Key: desde Vault (seguro)

[EXCELENTE] API Key viene desde Vault (maxima seguridad)

Resultado esperado:
   perfil_activo: 'prod'
   comision_porcentaje: 2.5
   limite_transaccional: 50000
   api_key_source: 'Vault (KV v2)'

================================================================
PRUEBA 2: Conversion con Comision 2.5%
================================================================

Objetivo: Verificar que PROD cobra comision del 2.5%
Endpoint: GET /api/tasas/convertir/USD?monto=1000
Operacion: Convertir 1,000 PEN a USD
Esperado: comision > 0

Ejecutando conversion...

Response (HTTP 200):
{
  "monto_origen": 1000.0,
  "moneda_origen": "PEN",
  "monto_convertido": 3750.0,
  "moneda_destino": "USD",
  "tasa_aplicada": 3.75,
  "comision": 93.75,
  "monto_total": 3843.75,
  "proveedor": "PremiumProvider",
  "limite_transaccional": 50000,
  "dentro_limite": true
}

PASS - Conversion realizada correctamente
Desglose de la conversion:
  Monto Original: $1,000 PEN
  Monto Convertido: $3,750.00 USD
  Comision (2.5%): $93.75 USD
  Total: $3,843.75 USD

[OK] PROD cobra comision completa del 2.5%

Resultado esperado:
   La comision debe ser mayor a 0 (2.5% del monto convertido)

================================================================
PRUEBA 3: Monto Alto Dentro de Limite
================================================================

Objetivo: Verificar que PROD acepta montos altos dentro del limite
Endpoint: GET /api/tasas/convertir/USD?monto=40000
Operacion: Convertir 40,000 PEN (dentro del limite de 50,000)
Esperado: dentro_limite: true

Ejecutando conversion con monto alto...

Response (HTTP 200):
{
  "monto_origen": 40000.0,
  "moneda_origen": "PEN",
  "monto_convertido": 150000.0,
  "moneda_destino": "USD",
  "tasa_aplicada": 3.75,
  "comision": 3750.0,
  "monto_total": 153750.0,
  "proveedor": "PremiumProvider",
  "limite_transaccional": 50000,
  "dentro_limite": true
}

PASS - Monto alto aceptado
Analisis del limite:
  Monto Solicitado: $40,000
  Limite Transaccional: $50,000
  Dentro de Limite: True

[OK] Monto aceptado en PROD

Resultado esperado:
   dentro_limite: true (40,000 < 50,000)

================================================================
PRUEBA 4: Exceder Limite en PROD
================================================================

Objetivo: Verificar deteccion de limite excedido
Endpoint: GET /api/tasas/convertir/USD?monto=60000
Operacion: Convertir 60,000 PEN (excede limite de 50,000)
Esperado: dentro_limite: false

Ejecutando conversion con monto que excede limite...

Response (HTTP 200):
{
  "monto_origen": 60000.0,
  "moneda_origen": "PEN",
  "monto_convertido": 225000.0,
  "moneda_destino": "USD",
  "tasa_aplicada": 3.75,
  "comision": 5625.0,
  "monto_total": 230625.0,
  "proveedor": "PremiumProvider",
  "limite_transaccional": 50000,
  "dentro_limite": false
}

PASS - Respuesta obtenida correctamente
Analisis del limite excedido:
  Monto Solicitado: $60,000
  Limite Transaccional: $50,000
  Dentro de Limite: False

[OK] Se detecto que excede el limite
[INFO] En produccion real, esto rechazaria la transaccion

Resultado esperado:
   dentro_limite: false (60,000 > 50,000)

================================================================
                    RESUMEN DE PRUEBAS                         
================================================================

  Total de tests:      4
  Tests Exitosos:  4
  Tests Fallidos:  0

================================================================
                   TESTS EJECUTADOS                            
================================================================

PRUEBA 1: Configuracion del perfil PROD + Vault verificada
PRUEBA 2: Conversion con comision completa (2.5%)
PRUEBA 3: Monto alto dentro de limite verificado
PRUEBA 4: Deteccion de limite excedido verificada

================================================================
              CARACTERISTICAS DEL PERFIL PROD                  
================================================================

Optimizado para:       Produccion con maxima seguridad
Comision:              2.5% (completa)
Limite:                50,000 (alto pero controlado)
Cache:                 Activado (rendimiento)
Auditoria:             Activada (trazabilidad)
Proveedor:             PremiumProvider (API externa)
Vault:                 Activado (maxima seguridad)

================================================================
                    ARCHIVO DE LOG                             
================================================================

Todas las pruebas han sido guardadas en:
   test-prod-2025-11-20_09-35-06.txt

Puedes revisar el log completo en cualquier momento para:
   - Verificar las respuestas HTTP completas
   - Analizar la configuracion del perfil PROD
   - Confirmar la integracion con Vault
   - Compartir los resultados con tu instructor
   - Documentar el comportamiento del sistema

Deteniendo la aplicacion...
Matando procesos previos de Quarkus y Java...
Limpieza completada

Pruebas del perfil PROD completadas exitosamente!
Este perfil esta listo para entornos de produccion con Vault.

