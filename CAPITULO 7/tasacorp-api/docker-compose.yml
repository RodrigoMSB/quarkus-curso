# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                   DOCKER COMPOSE - HASHICORP VAULT                       â•‘
# â•‘              GestiÃ³n de Secretos para TasaCorp API (PROD)               â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ“‹ PROPÃ“SITO DE ESTE ARCHIVO:
# Define la infraestructura de HashiCorp Vault en Docker para demostrar
# la gestiÃ³n segura de secretos en el perfil de PRODUCCIÃ“N.
#
# ğŸ¯ Â¿QUÃ‰ ES DOCKER COMPOSE?
#
# Docker Compose es una herramienta para definir y ejecutar aplicaciones
# Docker multi-contenedor usando un archivo YAML.
#
# VENTAJAS:
# âœ… Infraestructura como cÃ³digo
# âœ… Reproducible (mismo ambiente siempre)
# âœ… FÃ¡cil de compartir con el equipo
# âœ… Un comando levanta todo: docker-compose up
#
# ğŸ” Â¿POR QUÃ‰ VAULT?
#
# PROBLEMA:
# Las API keys y passwords NO deben estar en:
# - CÃ³digo fuente (git lo versiona para siempre)
# - Properties files (visibles para todo el equipo)
# - Variables de entorno simples (difÃ­ciles de rotar)
#
# SOLUCIÃ“N - VAULT:
# - Almacenamiento encriptado de secretos
# - Control de acceso granular
# - AuditorÃ­a de todos los accesos
# - RotaciÃ³n de secretos sin redeploy
# - Secretos con tiempo de vida (TTL)
#
# ğŸ“Š FLUJO DEL EJERCICIO:
#
# 1. Levantar Vault:
#    docker-compose up -d
#
# 2. Guardar secreto:
#    docker exec tasacorp-vault vault kv put secret/tasacorp api-key=SECRET
#
# 3. Quarkus lo lee automÃ¡ticamente:
#    %prod.tasacorp.provider.apikey=${api-key}
#
# 4. El cÃ³digo lo usa:
#    config.provider().apikey() â†’ "SECRET"
#
# âš ï¸ MODO DEV vs MODO PROD:
#
# Este archivo configura Vault en MODO DEV:
# - Para fines EDUCATIVOS y pruebas locales
# - NO es seguro para producciÃ³n real
# - Root token conocido (inseguro)
# - Sin TLS (HTTP, no HTTPS)
# - Datos en memoria (se pierden al reiniciar)
#
# En PRODUCCIÃ“N REAL necesitarÃ­as:
# - TLS habilitado (HTTPS)
# - Unsealing configurado
# - Storage persistente (Consul, etcd, S3)
# - PolÃ­ticas de acceso estrictas
# - Tokens rotables con TTL
#
# ğŸ”— RELACIÃ“N CON EL EJERCICIO:
#
# Solo se usa en perfil PROD:
# - DEV: API key hardcoded en properties
# - TEST: API key hardcoded en properties
# - PROD: API key desde Vault (este contenedor)

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                        VERSIÃ“N DE DOCKER COMPOSE                         â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ’¡ SIGNIFICADO:
# Especifica la versiÃ³n del formato del archivo docker-compose.
#
# VersiÃ³n 3.8:
# - Lanzada: Julio 2020
# - Compatible con Docker Engine 19.03.0+
# - Soporta todas las features modernas
# - Ãšltima versiÃ³n de la serie 3.x
#
# â„¹ï¸ NOTA:
# Docker Compose v2 (sin version key) es mÃ¡s nuevo,
# pero 3.8 tiene mayor compatibilidad en diferentes ambientes.

version: '3.8'

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                            SERVICIOS                                     â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ’¡ SIGNIFICADO:
# Define los contenedores que se van a ejecutar.
# En este caso, solo un servicio: Vault.

services:

  # ========================================
  # SERVICIO: VAULT
  # ========================================
  #
  # ğŸ” PROPÃ“SITO:
  # Servidor HashiCorp Vault para gestiÃ³n de secretos.
  # Proporciona almacenamiento seguro de la API key de producciÃ³n.
  
  vault:
    # ========================================
    # IMAGEN DE DOCKER
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Especifica quÃ© imagen de Docker usar.
    #
    # hashicorp/vault:1.15.2:
    # - Repositorio: hashicorp/vault (oficial)
    # - VersiÃ³n: 1.15.2 (estable)
    # - Source: Docker Hub
    #
    # ğŸ¯ Â¿POR QUÃ‰ ESTA VERSIÃ“N?
    # - 1.15.2 es estable y probada (Oct 2023)
    # - Compatible con todas las features del ejercicio
    # - Versiones posteriores tambiÃ©n funcionan
    #
    # ğŸ”„ ACTUALIZAR:
    # Puedes usar versiones mÃ¡s nuevas:
    # - hashicorp/vault:1.16.0
    # - hashicorp/vault:latest (no recomendado en prod)
    image: hashicorp/vault:1.15.2

    # ========================================
    # NOMBRE DEL CONTENEDOR
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Define un nombre fijo para el contenedor.
    #
    # Sin esto: Docker asigna nombre aleatorio (vault_1)
    # Con esto: Siempre se llama "tasacorp-vault"
    #
    # ğŸ¯ VENTAJAS:
    # - FÃ¡cil de referenciar en comandos
    # - Scripts pueden usar el nombre conocido
    # - Logs mÃ¡s claros
    #
    # ğŸ“ USO:
    # docker exec tasacorp-vault vault status
    # docker logs tasacorp-vault
    # docker stop tasacorp-vault
    container_name: tasacorp-vault

    # ========================================
    # PUERTOS
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Mapea puertos del host al contenedor.
    #
    # Formato: "HOST:CONTAINER"
    # "8200:8200" significa:
    # - Puerto 8200 del host (tu mÃ¡quina)
    # - Se conecta al puerto 8200 del contenedor
    #
    # ğŸŒ ACCESO:
    # Vault serÃ¡ accesible en:
    # - http://localhost:8200 (desde tu mÃ¡quina)
    # - http://host.docker.internal:8200 (desde otros contenedores)
    #
    # ğŸ¯ Â¿POR QUÃ‰ 8200?
    # Es el puerto estÃ¡ndar de Vault.
    # PodrÃ­as cambiarlo, pero mantener el estÃ¡ndar es mejor prÃ¡ctica.
    #
    # âš ï¸ PUERTO OCUPADO:
    # Si el puerto 8200 estÃ¡ en uso, cambia a otro:
    # ports:
    #   - "8201:8200"  # Host:8201, Container:8200
    ports:
      - "8200:8200"

    # ========================================
    # VARIABLES DE ENTORNO
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Define configuraciÃ³n mediante variables de entorno
    # que el contenedor de Vault leerÃ¡ al arrancar.
    #
    # Estas variables configuran Vault en MODO DEV:
    # - Arranque automÃ¡tico sin configuraciÃ³n manual
    # - Unseal automÃ¡tico (no necesita claves)
    # - Root token conocido (para acceso fÃ¡cil)
    #
    # âš ï¸ MODO DEV:
    # Estas configuraciones son INSEGURAS para producciÃ³n real.
    # Solo para desarrollo y aprendizaje.
    environment:
      
      # Root token de Vault en modo dev
      #
      # ğŸ’¡ SIGNIFICADO:
      # Define el token de acceso root (mÃ¡ximos privilegios).
      #
      # En modo dev: Token fijo "root" para facilitar pruebas
      # En prod real: Token generado aleatoriamente y protegido
      #
      # ğŸ”‘ USO:
      # export VAULT_TOKEN=root
      # vault kv put secret/tasacorp api-key=SECRET
      #
      # ğŸ”— QUARKUS:
      # application.properties:
      # %prod.quarkus.vault.authentication.client-token=root
      #
      # âš ï¸ SEGURIDAD:
      # En producciÃ³n NUNCA usar "root" como token.
      # Debe ser:
      # - Generado aleatoriamente
      # - Almacenado en secreto
      # - Con permisos limitados
      # - Con TTL (tiempo de vida)
      VAULT_DEV_ROOT_TOKEN_ID: root

      # DirecciÃ³n de escucha de Vault
      #
      # ğŸ’¡ SIGNIFICADO:
      # Define en quÃ© direcciÃ³n IP y puerto escucha Vault.
      #
      # 0.0.0.0:8200 significa:
      # - Escucha en TODAS las interfaces de red (0.0.0.0)
      # - Puerto 8200
      #
      # ğŸŒ IMPLICACIONES:
      # - Accesible desde localhost (127.0.0.1)
      # - Accesible desde el host (host.docker.internal)
      # - Accesible desde otros contenedores Docker
      #
      # ğŸ”’ ALTERNATIVAS:
      # - 127.0.0.1:8200 â†’ Solo localhost (mÃ¡s seguro)
      # - 0.0.0.0:8200 â†’ Todas las IPs (mÃ¡s flexible)
      #
      # Para este ejercicio: 0.0.0.0 permite que Quarkus
      # (corriendo fuera de Docker) se conecte a Vault.
      VAULT_DEV_LISTEN_ADDRESS: 0.0.0.0:8200

    # ========================================
    # CAPACIDADES (CAPABILITIES)
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Agrega capacidades del kernel Linux al contenedor.
    #
    # IPC_LOCK:
    # - Permite bloquear memoria en RAM
    # - Evita que secretos se escriban a swap (disco)
    #
    # ğŸ” Â¿POR QUÃ‰ ES IMPORTANTE?
    #
    # PROBLEMA SIN IPC_LOCK:
    # 1. Vault guarda secretos en RAM
    # 2. Sistema operativo puede mover RAM a swap (disco)
    # 3. Secretos quedan en disco sin encriptar
    # 4. Vulnerabilidad de seguridad
    #
    # SOLUCIÃ“N CON IPC_LOCK:
    # 1. Vault bloquea la memoria en RAM
    # 2. El OS NO puede mover esa memoria a swap
    # 3. Secretos NUNCA tocan el disco
    # 4. Mayor seguridad
    #
    # ğŸ“Š ANALOGÃA:
    # Es como decirle al OS:
    # "Esta memoria es MUY importante, NUNCA la muevas a disco"
    #
    # âš ï¸ NOTA:
    # En modo dev esto es menos crÃ­tico, pero es buena prÃ¡ctica
    # mantenerlo para simular configuraciÃ³n de producciÃ³n.
    cap_add:
      - IPC_LOCK

    # ========================================
    # COMANDO
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Comando que se ejecuta al iniciar el contenedor.
    # Sobrescribe el CMD de la imagen.
    #
    # vault server -dev:
    # - Inicia Vault en modo desarrollo
    #
    # ğŸ¯ MODO DESARROLLO (-dev):
    #
    # CaracterÃ­sticas:
    # âœ… Arranque automÃ¡tico (sin configuraciÃ³n manual)
    # âœ… Unseal automÃ¡tico (no necesita claves)
    # âœ… In-memory storage (rÃ¡pido, pero se pierde al reiniciar)
    # âœ… HTTP habilitado (sin TLS para facilitar pruebas)
    # âœ… Root token conocido (definido arriba)
    # âŒ NO ES SEGURO para producciÃ³n real
    #
    # ğŸ”„ MODO PRODUCCIÃ“N:
    # En producciÃ³n real usarÃ­as:
    # command: server -config=/vault/config/vault.hcl
    #
    # Con configuraciÃ³n completa:
    # - TLS habilitado (HTTPS)
    # - Storage persistente (Consul, etcd, S3)
    # - Unsealing manual o automÃ¡tico con KMS
    # - PolÃ­ticas de acceso estrictas
    #
    # ğŸ’¡ PARA ESTE EJERCICIO:
    # Modo dev es perfecto porque:
    # - FÃ¡cil de arrancar (docker-compose up)
    # - No requiere configuraciÃ³n compleja
    # - Suficiente para demostrar integraciÃ³n con Quarkus
    command: server -dev

    # ========================================
    # HEALTH CHECK
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Define cÃ³mo verificar si el contenedor estÃ¡ saludable.
    #
    # ğŸ¯ PROPÃ“SITO:
    # Permite a Docker (y orquestadores como Kubernetes)
    # saber si Vault estÃ¡ funcionando correctamente.
    #
    # ğŸ” COMPONENTES:
    healthcheck:
      
      # Comando para verificar salud
      #
      # vault status:
      # - Ejecuta el comando CLI de Vault
      # - Verifica que el servidor responde
      # - Exit code 0 = saludable
      # - Exit code != 0 = no saludable
      #
      # ğŸ’¡ SINTAXIS:
      # ["CMD", "comando", "arg1", "arg2"]
      # Es formato JSON de Docker
      #
      # ğŸ“Š ESTADOS POSIBLES:
      # - starting: Iniciando, aÃºn no chequeado
      # - healthy: PasÃ³ el health check
      # - unhealthy: FallÃ³ N veces consecutivas
      test: ["CMD", "vault", "status"]
      
      # Intervalo entre checks
      #
      # ğŸ’¡ SIGNIFICADO:
      # Cada 10 segundos, Docker ejecuta el health check.
      #
      # ğŸ¯ CONSIDERACIONES:
      # - Muy bajo (5s): Mayor carga, detecciÃ³n rÃ¡pida
      # - Muy alto (60s): Menor carga, detecciÃ³n lenta
      # - 10s: Balance razonable para dev/test
      #
      # En producciÃ³n podrÃ­as usar:
      # - Liveness: interval: 30s (Â¿estÃ¡ vivo?)
      # - Readiness: interval: 5s (Â¿estÃ¡ listo?)
      interval: 10s
      
      # Timeout del check
      #
      # ğŸ’¡ SIGNIFICADO:
      # Si el comando tarda mÃ¡s de 5 segundos, se considera fallido.
      #
      # ğŸ¯ RAZÃ“N:
      # vault status normalmente responde en < 1 segundo.
      # 5 segundos es generoso para:
      # - Sistemas lentos
      # - Vault bajo carga
      # - Inicio del contenedor
      timeout: 5s
      
      # Reintentos antes de marcar unhealthy
      #
      # ğŸ’¡ SIGNIFICADO:
      # Debe fallar 3 veces CONSECUTIVAS para marcarse unhealthy.
      #
      # ğŸ¯ RAZÃ“N:
      # Evita false positives:
      # - Un timeout ocasional no marca unhealthy
      # - Solo fallas persistentes cambian el estado
      #
      # ğŸ“Š EJEMPLO:
      # Check 1: âœ… OK â†’ healthy
      # Check 2: âŒ Fail â†’ still healthy (1/3)
      # Check 3: âŒ Fail â†’ still healthy (2/3)
      # Check 4: âŒ Fail â†’ unhealthy (3/3) ğŸ’€
      # Check 5: âœ… OK â†’ healthy again
      retries: 3

    # ========================================
    # REDES
    # ========================================
    #
    # ğŸ’¡ SIGNIFICADO:
    # Define a quÃ© redes Docker pertenece este contenedor.
    #
    # ğŸŒ RED: tasacorp-network
    # - Definida abajo en la secciÃ³n "networks"
    # - Permite comunicaciÃ³n entre contenedores
    # - Aislamiento de red (no usa la red default)
    #
    # ğŸ¯ Â¿POR QUÃ‰ UNA RED PERSONALIZADA?
    #
    # VENTAJAS:
    # âœ… DNS automÃ¡tico (los contenedores se ven por nombre)
    # âœ… Aislamiento (otros contenedores no pueden acceder)
    # âœ… Escalabilidad (agregar mÃ¡s servicios fÃ¡cilmente)
    #
    # EJEMPLO:
    # Si agregas el microservicio Quarkus al compose:
    #
    # services:
    #   vault:
    #     networks:
    #       - tasacorp-network
    #
    #   quarkus-app:
    #     networks:
    #       - tasacorp-network
    #     environment:
    #       - QUARKUS_VAULT_URL=http://vault:8200
    #                                   ^^^^^
    #                                   Nombre del servicio (DNS automÃ¡tico)
    #
    # ğŸ’¡ PARA ESTE EJERCICIO:
    # Como Quarkus corre FUERA de Docker (./mvnw quarkus:dev),
    # la red no es estrictamente necesaria, pero es buena prÃ¡ctica.
    networks:
      - tasacorp-network

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                              REDES                                       â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ’¡ SIGNIFICADO:
# Define redes Docker personalizadas para los servicios.

networks:
  
  # ========================================
  # RED: TASACORP-NETWORK
  # ========================================
  #
  # ğŸŒ PROPÃ“SITO:
  # Red bridge personalizada para comunicaciÃ³n entre contenedores.
  #
  # ğŸ¯ CARACTERÃSTICAS:
  tasacorp-network:
    
    # Driver de red
    #
    # ğŸ’¡ SIGNIFICADO:
    # Define el tipo de red.
    #
    # bridge:
    # - Red privada en el host
    # - Contenedores se comunican entre sÃ­
    # - Aislados de la red externa (a menos que expongas puertos)
    #
    # ğŸ”— OTROS DRIVERS:
    # - host: Usa la red del host directamente (sin aislamiento)
    # - overlay: Para Docker Swarm (multi-host)
    # - macvlan: Asigna MAC address al contenedor
    # - none: Sin red
    #
    # ğŸ“Š PARA ESTE EJERCICIO:
    # bridge es perfecto porque:
    # - Aislamiento adecuado
    # - DNS automÃ¡tico entre contenedores
    # - FÃ¡cil de entender
    driver: bridge

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                          COMANDOS ÃšTILES                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸš€ LEVANTAR VAULT:
# docker-compose up -d
#
# Flags:
# -d: Detached (corre en background)
# Sin -d: Muestra logs en tiempo real (Ctrl+C para parar)
#
# ğŸ“Š VER LOGS:
# docker-compose logs -f vault
#
# Flags:
# -f: Follow (streaming de logs en tiempo real)
# --tail=100: Solo Ãºltimas 100 lÃ­neas
#
# ğŸ” VERIFICAR ESTADO:
# docker-compose ps
#
# Muestra:
# - Estado (Up/Exited)
# - Puertos expuestos
# - Health status
#
# ğŸ’¾ GUARDAR SECRETO EN VAULT:
# docker exec -it tasacorp-vault sh -c \
#   "VAULT_ADDR=http://127.0.0.1:8200 VAULT_TOKEN=root \
#    vault kv put secret/tasacorp api-key=MI_SECRETO"
#
# ğŸ” LEER SECRETO DE VAULT:
# docker exec -it tasacorp-vault sh -c \
#   "VAULT_ADDR=http://127.0.0.1:8200 VAULT_TOKEN=root \
#    vault kv get secret/tasacorp"
#
# ğŸ›‘ DETENER VAULT:
# docker-compose down
#
# Flags:
# (sin flags): Detiene y elimina contenedores
# -v: TambiÃ©n elimina volÃºmenes (borra datos)
#
# ğŸ”„ REINICIAR VAULT:
# docker-compose restart vault
#
# âš ï¸ NOTA EN MODO DEV:
# Al reiniciar, PIERDES todos los secretos (in-memory storage).
# Necesitas volver a guardarlos.
#
# ğŸ§¹ LIMPIAR TODO:
# docker-compose down -v
# docker system prune -a
#
# âš ï¸ CUIDADO: Esto elimina TODO (contenedores, imÃ¡genes, volÃºmenes)

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                  DIFERENCIAS: DEV MODE vs PROD MODE                      â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ“Š COMPARATIVA:
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ CaracterÃ­stica     â”‚   MODO DEV       â”‚    MODO PROD         â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ Comando            â”‚ server -dev      â”‚ server -config=...   â”‚
# â”‚ Storage            â”‚ In-memory        â”‚ Consul/etcd/S3       â”‚
# â”‚ TLS                â”‚ âŒ Desactivado   â”‚ âœ… Obligatorio       â”‚
# â”‚ Unsealing          â”‚ AutomÃ¡tico       â”‚ Manual/Auto con KMS  â”‚
# â”‚ Root Token         â”‚ "root" (fijo)    â”‚ Generado/Rotable     â”‚
# â”‚ Datos persisten    â”‚ âŒ No            â”‚ âœ… SÃ­                â”‚
# â”‚ Puerto             â”‚ 8200 (HTTP)      â”‚ 8200 (HTTPS)         â”‚
# â”‚ AuditorÃ­a          â”‚ Limitada         â”‚ Completa             â”‚
# â”‚ HA (Alta Disp.)    â”‚ âŒ No            â”‚ âœ… MÃºltiples nodos   â”‚
# â”‚ Uso                â”‚ Dev/Learning     â”‚ ProducciÃ³n           â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ğŸ¯ PARA ESTE EJERCICIO:
# Modo DEV es perfecto porque:
# âœ… Arranque en 5 segundos
# âœ… Sin configuraciÃ³n compleja
# âœ… Suficiente para demostrar integraciÃ³n Quarkus + Vault
# âœ… FÃ¡cil de destruir y recrear
#
# âš ï¸ EN PRODUCCIÃ“N REAL:
# NecesitarÃ­as un setup mucho mÃ¡s robusto:
# - Cluster de 3+ nodos (Alta Disponibilidad)
# - Storage en Consul o similar
# - TLS con certificados vÃ¡lidos
# - Backup automÃ¡tico de datos
# - Monitoreo con Prometheus/Grafana
# - PolÃ­ticas de acceso granulares
# - IntegraciÃ³n con LDAP/AD para autenticaciÃ³n

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                        TROUBLESHOOTING                                   â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# âŒ ERROR: "Port 8200 is already in use"
#
# SOLUCIÃ“N 1 - Cambiar puerto:
# ports:
#   - "8201:8200"
#
# SOLUCIÃ“N 2 - Matar proceso:
# lsof -i :8200  # Ver quÃ© usa el puerto
# kill -9 <PID>  # Matar proceso
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
# âŒ ERROR: "Cannot connect to the Docker daemon"
#
# SOLUCIÃ“N:
# - Verificar que Docker Desktop estÃ¡ corriendo
# - Windows: Abrir Docker Desktop
# - Mac: Abrir Docker Desktop
# - Linux: sudo systemctl start docker
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
# âŒ ERROR: Vault unhealthy despuÃ©s de 30 segundos
#
# SOLUCIÃ“N:
# docker-compose logs vault  # Ver quÃ© pasÃ³
#
# Posibles causas:
# - Puerto 8200 ocupado
# - Falta de recursos (RAM/CPU)
# - Problema con IPC_LOCK capability
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
# âŒ ERROR: Quarkus no puede conectarse a Vault
#
# VERIFICAR:
# 1. Â¿Vault estÃ¡ corriendo?
#    docker ps | grep vault
#
# 2. Â¿Vault responde?
#    curl http://localhost:8200/v1/sys/health
#
# 3. Â¿El secreto existe?
#    docker exec tasacorp-vault vault kv get secret/tasacorp
#
# 4. Â¿La configuraciÃ³n de Quarkus es correcta?
#    application.properties:
#    %prod.quarkus.vault.url=http://localhost:8200
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
# âŒ ERROR: "Lost all secrets after restart"
#
# EXPLICACIÃ“N:
# En modo DEV, Vault usa in-memory storage.
# Al reiniciar, se pierden todos los datos.
#
# SOLUCIÃ“N:
# Volver a guardar los secretos despuÃ©s de cada restart:
# docker exec tasacorp-vault vault kv put secret/tasacorp api-key=SECRET
#
# ALTERNATIVA (para no perder datos):
# Usar volumen persistente:
# volumes:
#   - vault-data:/vault/file
#
# Y cambiar a modo server (no dev):
# command: server -config=/vault/config/vault.hcl

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                          RESUMEN FINAL                                   â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¯ ESTE ARCHIVO DEFINE:
#
# âœ… UN CONTENEDOR:
#    HashiCorp Vault 1.15.2 en modo desarrollo
#
# âœ… PROPÃ“SITO:
#    Demostrar gestiÃ³n segura de secretos en el perfil PROD
#
# âœ… CONFIGURACIÃ“N:
#    - Puerto: 8200
#    - Token: root (solo para dev)
#    - Storage: In-memory (no persiste)
#    - TLS: Desactivado (solo para dev)
#
# âœ… INTEGRACIÃ“N:
#    Quarkus lee secretos automÃ¡ticamente en modo PROD
#
# ğŸ”— FLUJO COMPLETO:
#
# 1. docker-compose up -d
# 2. docker exec ... vault kv put secret/tasacorp api-key=SECRET
# 3. ./mvnw quarkus:dev -Dquarkus.profile=prod
# 4. Quarkus lee el secreto de Vault
# 5. config.provider().apikey() â†’ "SECRET"
#
# ğŸ“– APRENDER MÃS:
# - README-PARTE2.md: GuÃ­a de integraciÃ³n Vault + Quarkus
# - TEORIA-PARTE2.md: TeorÃ­a profunda de gestiÃ³n de secretos
# - https://www.vaultproject.io/docs - DocumentaciÃ³n oficial

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                    FIN DE DOCKER COMPOSE                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•