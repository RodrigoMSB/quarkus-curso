================================================================================
REPORTE DE PRUEBAS FUNCIONALES
Customer Service - GestiÃ³n de Clientes Empresariales
================================================================================

Fecha de ejecuciÃ³n: 2025-10-25 21:25:42
Servicio bajo prueba: http://localhost:8081

Generado por: test-customer-service.sh
Sistema operativo: Darwin

Este reporte contiene los resultados de las pruebas funcionales del
Customer Service, incluyendo:
  - Health checks y endpoints base
  - CRUD de clientes con validaciones
  - Redis Cache (latencias y mejora de rendimiento)
  - BÃºsquedas por RUC e industria
  - ValidaciÃ³n de datos (Bean Validation)
  - OpenAPI y mÃ©tricas

TecnologÃ­as probadas:
  âœ“ Panache Active Record (Hibernate ORM)
  âœ“ Google Tink (cifrado de RUC)
  âœ“ Redis Cache (rendimiento)
  âœ“ Bean Validation (validaciones)
  âœ“ Fault Tolerance (Circuit Breaker, Retry)

================================================================================


============================================================================
ğŸš€ PRUEBAS FUNCIONALES - CUSTOMER SERVICE
============================================================================


PRUEBAS INCLUIDAS:
   1. Health Checks y conectividad
   2. Listar clientes activos (datos pre-cargados)
   3. Crear nuevo cliente con validaciones
   4. Obtener cliente por ID
   5. Redis Cache - MediciÃ³n de rendimiento
      - Cache MISS (primera consulta desde PostgreSQL)
      - Cache HIT (consultas subsecuentes desde Redis)
      - ComparaciÃ³n de latencias
   6. Actualizar cliente existente
   7. Buscar por RUC (campo cifrado)
   8. Buscar por industria
   9. Validaciones (Bean Validation)
  10. OpenAPI y mÃ©tricas

â„¹ Verificando conectividad con http://localhost:8081...
âœ“ Servicio disponible y respondiendo
Servicio verificado: OK
â„¹ Obteniendo JWT token de Keycloak...
âœ“ JWT token obtenido exitosamente
â„¹ Token vÃ¡lido por 5 minutos (300 segundos)
JWT Token: Obtenido correctamente
Token length: 1499 caracteres

============================================================================
ğŸ”¥ PRUEBA 1: HEALTH CHECKS Y CONECTIVIDAD
============================================================================


>>> 1.1 - Health Check bÃ¡sico

â„¹ Verificando que el servicio estÃ© operativo...
Response: Customer Service is UP
HTTP Code: 200
âœ“ Servicio operativo: Customer Service is UP
âœ“ TEST #1: Health check bÃ¡sico

>>> 1.2 - Health Check detallado (Quarkus)

â„¹ Verificando health checks de Quarkus...

Health Check completo:
{
  "status": "UP",
  "checks": [
    {
      "name": "Database connections health check",
      "status": "UP",
      "data": {
        "<default>": "UP"
      }
    },
    {
      "name": "Redis connection health check",
      "status": "UP",
      "data": {
        "default": "PONG"
      }
    }
  ]
}
âœ“ TEST #2: Health check Quarkus



============================================================================
ğŸ‘¤ PRUEBA 2: LISTAR CLIENTES ACTIVOS
============================================================================


>>> 2.1 - Obtener todos los clientes activos

â„¹ Consultando clientes pre-cargados en la base de datos...

Clientes activos:
[
  {
    "id": 1,
    "rucMasked": "XXXXXXXXX89",
    "legalName": "Tech Innovations S.A.C.",
    "tradeName": "TechInnov",
    "industry": "TECHNOLOGY",
    "foundedDate": "2010-03-15",
    "annualRevenue": 15000000.00,
    "contactEmail": "contacto@techinno.pe",
    "contactPhone": "+51987654321",
    "address": "Av. InnovaciÃ³n 123",
    "city": "Lima",
    "status": "ACTIVE",
    "creditScore": 850,
    "riskCategory": "AAA",
    "sunatValidated": true,
    "createdAt": "2025-10-25T21:19:31.48829",
    "updatedAt": "2025-10-25T21:19:31.48829",
    "createdBy": "system",
    "isHighRisk": false,
    "isPremium": true
  },
  {
    "id": 2,
    "rucMasked": "XXXXXXXXX21",
    "legalName": "Comercial del Sur S.A.",
    "tradeName": "ComSur",
    "industry": "RETAIL",
    "foundedDate": "2015-07-20",
â„¹ Total de clientes activos: 5
Total: 5 clientes
âœ“ Datos pre-cargados disponibles
âœ“ TEST #3: Listar clientes activos



============================================================================
ğŸ” PRUEBA 3: CREAR NUEVO CLIENTE
============================================================================


>>> 3.1 - Crear cliente con todos los campos vÃ¡lidos

â„¹ Enviando solicitud para crear cliente...
â„¹ RUC serÃ¡ cifrado con Google Tink antes de almacenar
Request:
{
  "ruc": "20456789012",
  "legalName": "Tech Innovations Peru S.A.C.",
  "tradeName": "TechPeru",
  "industry": "TECHNOLOGY",
  "foundedDate": "2020-01-15",
  "annualRevenue": 5000000.00,
  "contactEmail": "contacto@techperu.pe",
  "contactPhone": "+51987654999",
  "address": "Av. TecnologÃ­a 500",
  "city": "Lima"
}

Response:
500

500 - Internal Server Error
------------------------

Details:
	Error id 1563e532-c76a-4c64-9a95-83338a238536-1, java.lang.IllegalArgumentException: Ya existe un cliente con RUC: 20456789012
Decorate (Source code):
	Exception in CustomerService.java:60
	   58          Customer existing = Customer.findByRuc(encryptedRuc);
	   59          if (existing != null) {
	-> 60              throw new IllegalArgumentException("Ya existe un cliente con RUC: " + request.getRuc());
	   61          }
	   62  
Stack:
	java.lang.IllegalArgumentException: Ya existe un cliente con RUC: 20456789012
	at pe.banco.customer.service.CustomerService.createCustomer(CustomerService.java:60)
	at pe.banco.customer.service.CustomerService_Subclass.createCustomer$$superforward(Unknown Source)
	at pe.banco.customer.service.CustomerService_Subclass$$function$$2.apply(Unknown Source)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:73)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:62)
	at io.quarkus.narayana.jta.runtime.interceptor.TransactionalInterceptorBase.invokeInOurTx(TransactionalInterceptorBase.java:136)
	at io.quarkus.narayana.jta.runtime.interceptor.TransactionalInterceptorBase.invokeInOurTx(TransactionalInterceptorBase.java:107)
	at io.quarkus.narayana.jta.runtime.interceptor.TransactionalInterceptorRequired.doIntercept(TransactionalInterceptorRequired.java:38)
	at io.quarkus.narayana.jta.runtime.interceptor.TransactionalInterceptorBase.intercept(TransactionalInterceptorBase.java:61)
	at io.quarkus.narayana.jta.runtime.interceptor.TransactionalInterceptorRequired.intercept(TransactionalInterceptorRequired.java:32)
	at io.quarkus.narayana.jta.runtime.interceptor.TransactionalInterceptorRequired_Bean.intercept(Unknown Source)
	at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:30)
	at io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:27)
	at pe.banco.customer.service.CustomerService_Subclass.createCustomer(Unknown Source)
	at pe.banco.customer.service.CustomerService_ClientProxy.createCustomer(Unknown Source)
	at pe.banco.customer.resource.CustomerResource.createCustomer(CustomerResource.java:69)
	at pe.banco.customer.resource.CustomerResource_Subclass.createCustomer$$superforward(Unknown Source)
	at pe.banco.customer.resource.CustomerResource_Subclass$$function$$1.apply(Unknown Source)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:73)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext$NextAroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:97)
	at io.quarkus.hibernate.validator.runtime.interceptor.AbstractMethodValidationInterceptor.validateMethodInvocation(AbstractMethodValidationInterceptor.java:71)
	at io.quarkus.hibernate.validator.runtime.jaxrs.ResteasyReactiveEndPointValidationInterceptor.validateMethodInvocation(ResteasyReactiveEndPointValidationInterceptor.java:21)
	at io.quarkus.hibernate.validator.runtime.jaxrs.ResteasyReactiveEndPointValidationInterceptor_Bean.intercept(Unknown Source)
	at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:70)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext$NextAroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:97)
	at io.quarkus.security.runtime.interceptor.SecurityHandler.handle(SecurityHandler.java:27)
	at io.quarkus.security.runtime.interceptor.RolesAllowedInterceptor.intercept(RolesAllowedInterceptor.java:29)
	at io.quarkus.security.runtime.interceptor.RolesAllowedInterceptor_Bean.intercept(Unknown Source)
	at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:70)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:62)
	at io.quarkus.resteasy.reactive.server.runtime.StandardSecurityCheckInterceptor.intercept(StandardSecurityCheckInterceptor.java:44)
	at io.quarkus.resteasy.reactive.server.runtime.StandardSecurityCheckInterceptor_RolesAllowedInterceptor_Bean.intercept(Unknown Source)
	at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)
	at io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:30)
	at io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:27)
	at pe.banco.customer.resource.CustomerResource_Subclass.createCustomer(Unknown Source)
	at pe.banco.customer.resource.CustomerResource$quarkusrestinvoker$createCustomer_bc6abdb381288e3dfa738d4c9ba128a8359d839d.invoke(Unknown Source)
	at org.jboss.resteasy.reactive.server.handlers.InvocationHandler.handle(InvocationHandler.java:29)
	at io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:141)
	at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:147)
	at io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:635)
	at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2516)
	at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2495)
	at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1521)
	at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:11)
	at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:11)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
âœ— No se pudo obtener ID del cliente
âœ— TEST #4: Crear cliente nuevo (esperado: 201, obtenido: 500)



============================================================================
ğŸ” PRUEBA 4: OBTENER CLIENTE POR ID
============================================================================

âš  Saltando prueba - no se pudo crear cliente en paso anterior
â„¹ Usando cliente ID: 1 (pre-cargado)

============================================================================
âš¡ PRUEBA 5: REDIS CACHE - RENDIMIENTO
============================================================================


>>> 5.1 - Primera consulta (Cache MISS)

â„¹ Consultando cliente 1 por primera vez...
â„¹ Esta consulta irÃ¡ a PostgreSQL (mÃ¡s lenta)...
âœ“ Latencia primera consulta: 69ms
Latencia: 69ms (Cache MISS - desde PostgreSQL)
âœ“ TEST #5: Primera consulta (Cache MISS)

>>> 5.2 - Verificar Redis (si docker disponible)

â„¹ Verificando Redis con docker exec...
â„¹ Clave no verificable directamente (puede estar cifrada o con prefix)
Redis Cache: Clave no verificable con docker exec

>>> 5.3 - Segunda consulta (Cache HIT esperado)

â„¹ Consultando cliente 1 nuevamente...
â„¹ Esta consulta deberÃ­a venir desde Redis (mÃ¡s rÃ¡pida)...
âœ“ Latencia segunda consulta: 60ms
Latencia: 60ms (Cache HIT - desde Redis)
âœ“ âœ¨ Â¡Cache funcionando! Mejora de rendimiento: 14%
âœ“ La segunda consulta fue 14% mÃ¡s rÃ¡pida
Mejora de rendimiento: 14%
ComparaciÃ³n: 69ms (BD) â†’ 60ms (Cache)
âœ“ TEST #6: Segunda consulta (Cache HIT)

>>> 5.4 - Tercera consulta (validar cache persistente)

â„¹ Consultando una vez mÃ¡s para confirmar cache...
â„¹ Latencia tercera consulta: 64ms
Latencia tercera consulta: 64ms
â„¹ 
â„¹ ğŸ“Š ComparaciÃ³n de las 3 consultas:
â„¹   1Âª consulta (Cache MISS):        69ms  â† Desde PostgreSQL
â„¹   2Âª consulta (Cache HIT):         60ms  â† Desde Redis
â„¹   3Âª consulta (Cache persistente): 64ms  â† Desde Redis

RESUMEN CACHE:
  1Âª: 69ms (MISS - PostgreSQL)
  2Âª: 60ms (HIT - Redis)
  3Âª: 64ms (HIT - Redis)
âœ“ 
âœ“ âœ… CACHE CONFIRMADO: Promedio 62ms vs 69ms inicial
âœ“    Mejora total: 11%

CONCLUSIÃ“N CACHE: Funcionando correctamente (11% mejora)
âœ“ TEST #7: Tercera consulta (Cache persistente)



============================================================================
ğŸ‘¤ PRUEBA 6: ACTUALIZAR CLIENTE
============================================================================


>>> 6.1 - Actualizar datos del cliente 1

â„¹ Actualizando cliente...
â„¹ Cambios: tradeName, annualRevenue, contactEmail, contactPhone, address
Request:
{
      "ruc": "20456789012",
      "legalName": "Tech Innovations Peru S.A.C.",
      "tradeName": "TechPeru Pro",
      "industry": "TECHNOLOGY",
      "foundedDate": "2020-01-15",
      "annualRevenue": 7500000.00,
      "contactEmail": "nuevo@techperu.pe",
      "contactPhone": "+51987654888",
      "address": "Av. TecnologÃ­a 600",
      "city": "Lima"
    }

Response:
{
  "id": 1,
  "rucMasked": "XXXXXXXXX89",
  "legalName": "Tech Innovations Peru S.A.C.",
  "tradeName": "TechPeru Pro",
  "industry": "TECHNOLOGY",
  "foundedDate": "2020-01-15",
  "annualRevenue": 7500000.00,
  "contactEmail": "nuevo@techperu.pe",
  "contactPhone": "+51987654888",
  "address": "Av. TecnologÃ­a 600",
  "city": "Lima",
  "status": "ACTIVE",
  "creditScore": 850,
  "riskCategory": "AAA",
  "sunatValidated": true,
  "createdAt": "2025-10-25T21:19:31.48829",
  "updatedAt": "2025-10-25T21:19:31.48829",
  "createdBy": "system",
  "isHighRisk": false,
  "isPremium": true
}
âœ“ Cliente actualizado correctamente
â„¹ âœ“ Cache invalidado automÃ¡ticamente (@CacheInvalidate)
âœ“ TEST #8: Actualizar cliente

============================================================================
ğŸ” PRUEBA 7: BUSCAR CLIENTE POR RUC
============================================================================


>>> 7.1 - Buscar por RUC (campo cifrado)

â„¹ Buscando cliente con RUC: 20456789012
â„¹ El servicio cifrarÃ¡ el RUC antes de buscar en BD...

Cliente encontrado:
{
  "id": 6,
  "rucMasked": "XXXXXXXXX12",
  "legalName": "Tech Innovations Peru S.A.C.",
  "tradeName": "TechPeru Pro",
  "industry": "TECHNOLOGY",
  "foundedDate": "2020-01-15",
  "annualRevenue": 7500000.00,
  "contactEmail": "nuevo@techperu.pe",
  "contactPhone": "+51987654888",
  "address": "Av. TecnologÃ­a 600",
  "city": "Lima",
  "status": "ACTIVE",
  "creditScore": null,
  "riskCategory": null,
  "sunatValidated": false,
  "createdAt": "2025-10-25T21:21:52.956127",
  "updatedAt": "2025-10-25T21:21:53.608441",
  "createdBy": "admin-user",
  "isHighRisk": false,
âœ“ Cliente encontrado por RUC
â„¹ RUC enmascarado en respuesta: XXXXXXXXX12
âœ“ TEST #9: Buscar cliente por RUC



============================================================================
ğŸ” PRUEBA 8: BUSCAR POR INDUSTRIA
============================================================================


>>> 8.1 - Listar clientes de industria TECHNOLOGY

â„¹ Filtrando clientes por sector industrial...

Clientes TECHNOLOGY:
[
  {
    "id": 6,
    "rucMasked": "XXXXXXXXX12",
    "legalName": "Tech Innovations Peru S.A.C.",
    "tradeName": "TechPeru Pro",
    "industry": "TECHNOLOGY",
    "foundedDate": "2020-01-15",
    "annualRevenue": 7500000.00,
    "contactEmail": "nuevo@techperu.pe",
    "contactPhone": "+51987654888",
    "address": "Av. TecnologÃ­a 600",
    "city": "Lima",
    "status": "ACTIVE",
    "creditScore": null,
    "riskCategory": null,
    "sunatValidated": false,
    "createdAt": "2025-10-25T21:21:52.956127",
    "updatedAt": "2025-10-25T21:21:53.608441",
    "createdBy": "admin-user",
    "isHighRisk": false,
    "isPremium": false
  },
  {
    "id": 1,
    "rucMasked": "XXXXXXXXX89",
    "legalName": "Tech Innovations Peru S.A.C.",
    "tradeName": "TechPeru Pro",
    "industry": "TECHNOLOGY",
    "foundedDate": "2020-01-15",
â„¹ Total clientes en TECHNOLOGY: 2
Total: 2 clientes
âœ“ TEST #10: Listar por industria



============================================================================
âŒ PRUEBA 9: VALIDACIONES - BEAN VALIDATION
============================================================================


>>> 9.1 - RUC invÃ¡lido (formato incorrecto)

â„¹ Intentando crear cliente con RUC de solo 3 dÃ­gitos...

Response (error esperado):
{"title":"Constraint Violation","status":400,"violations":[{"field":"createCustomer.request.ruc","message":"El RUC debe tener exactamente 11 dÃ­gitos"}]}
âœ“ ValidaciÃ³n funcionÃ³ correctamente (400 Bad Request)
â„¹ El servicio rechazÃ³ RUC con formato incorrecto
âœ“ TEST #11: Validar RUC formato incorrecto

>>> 9.2 - Email invÃ¡lido

â„¹ Intentando crear cliente con email sin formato correcto...

Response (error esperado):
{"title":"Constraint Violation","status":400,"violations":[{"field":"createCustomer.request.contactEmail","message":"El email no tiene formato vÃ¡lido"}]}
âœ“ ValidaciÃ³n de email funcionÃ³ correctamente
âœ“ TEST #12: Validar email formato incorrecto



============================================================================
ğŸ“Š PRUEBA 10: OPENAPI Y MÃ‰TRICAS
============================================================================


>>> 10.1 - OpenAPI Specification

â„¹ Consultando especificaciÃ³n OpenAPI...

OpenAPI (primeras lÃ­neas):
---
openapi: 3.0.3
info:
  title: Customer Service API
  description: GestiÃ³n de clientes empresariales con cifrado y cachÃ©
  version: 1.0.0
tags:
- name: Customers
  description: GestiÃ³n de clientes empresariales
paths:
  /api/customers:
    get:
      tags:
      - Customers
      summary: Listar clientes activos
âœ“ TEST #13: OpenAPI disponible

>>> 10.2 - MÃ©tricas (Micrometer)

â„¹ Consultando mÃ©tricas de la aplicaciÃ³n...

MÃ©tricas (muestra):
âœ— TEST #14: MÃ©tricas disponibles (esperado: 200, obtenido: 404)
â„¹ 
â„¹ URLs Ãºtiles:
â„¹   - Swagger UI: http://localhost:8081/q/swagger-ui
â„¹   - Health:     http://localhost:8081/q/health
â„¹   - Metrics:    http://localhost:8081/q/metrics

URLs del servicio:
  - Swagger UI: http://localhost:8081/q/swagger-ui
  - Health:     http://localhost:8081/q/health
  - Metrics:    http://localhost:8081/q/metrics

============================================================================
ğŸ“Š RESUMEN DE PRUEBAS
============================================================================


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    RESULTADOS FINALES                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Total de pruebas:    14                                        â•‘
â•‘ Pruebas exitosas:    12                                        â•‘
â•‘ Pruebas fallidas:    2                                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ— Algunas pruebas fallaron. Revisa los logs arriba.

CONCLUSIÃ“N: Sistema con fallas. Revisar pruebas fallidas.

================================================================================
FIN DEL REPORTE
================================================================================

Archivo generado: customer-service-report-2025-10-25-212542.txt
Fecha: 2025-10-25 21:25:59

Para mÃ¡s informaciÃ³n, consulta:
- README.md: GuÃ­a de usuario
- TEORIA.md: Conceptos tÃ©cnicos sobre Panache, Tink, Cache, etc.
- instructor.md: GuÃ­a del profesor

CapÃ­tulo 11: Customer Service con Quarkus
TecnologÃ­as implementadas:
  - Panache Active Record (simplificaciÃ³n de JPA)
  - Google Tink (cifrado de datos sensibles)
  - Redis Cache (optimizaciÃ³n de rendimiento)
  - Fault Tolerance (Circuit Breaker, Retry, Timeout)
  - Bean Validation (validaciones declarativas)
  - RESTEasy Reactive (endpoints REST)

================================================================================
âœ“ Reporte guardado en: customer-service-report-2025-10-25-212542.txt
